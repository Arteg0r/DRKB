#spec #event

## Введение в События 

События  являются способом прокачки характеристик и черт Героев в Экспедиции. События  возникают на незанятых Противниками и POI Гексах. События происходят при занятии Отрядом Гекса, при соблюдении всех условий. 


## Условия появления События

- Отряд завершил перемещение на новый Гекс
- На Гексе нет Противника или POI
- Совпала пара триггеров: Атрибут Гекса и Черта Героя
- Сработала вероятность события, зависящая от Силы Черты Героя 


## Атрибуты гекса и черты Героя 

Гекс может содержать атрибут для События (или несколько). Но может и не содержать - на таком Гексе События подобного типа не происходят. 

Герой может обладать чертой (или несколькими). Но может и не обладать ни одной чертой - тогда События Гекса с ним не происходят (пока он не получит какую-то черту). В данный момент Черту можно получить только через События, но в будущем может появиться.

Событие может появляться на разных типах Гексах (если не указано обратное), имеющих нужный Атрибут, триггерящий черту Героя. Например, на разных типах Гексов может расти Дерево или Цветок.  

Событие может происходить с разными Героями, у которых есть нужная ему черта, триггерящая Событие. Например, черта Грибник или Чистюла, или обе сразу, может быть и у Мага Огня, и у Рыцаря.

Список Черт и Атрибутов и их комбинации описаны на этом листе: https://docs.google.com/spreadsheets/d/12acMQ8UTlDRHP0NvzSGVLYKb9QMhw2AjD9EKXTQug3U/edit#gid=1297383192


## Логика работы Процессора Событий

Для удобства, под Процессором Событий понимаем код, отвечающий за манипуляции с Событиями.

1. Процессор отбирает из реестра событий те, которые вообще возможны - совпадают Атрибуты Гекса и Черты Героев (из активного отряда)
3. Процессор выясняет, возникло ли Событие, исходя из условий вероятности,  записанной в Черте Героя (1 ур - 10%, 2 ур - 15%...)
4. Если сработали несколько Событий, процессор выбирает самое высокоуровневое (от Силы Черты), если таких несколько - выбирает одно из них случайным образом (никогда не показываем на одном Гексе несколько Событий!)
5. По выбранному Событию Процессор:
	1. выбирает шаблон художественного описания (исходя из уровня События)
	2. отбирает части шаблона из словарая Событий, собирает из них описание
	3. определяет награды для обоих вариантов результата События, согласно указанным вероятностям (выбирает одно из двух улучшений в Варианте 1 и черту или ее отсутствие в Варианте 2)
6. Процессор блокирует управление на Карте Мира и показывает интерфейс События
8. Процессор записывает изменения характеристик/черт Героев согласно выбору игрока; закрывает интерфейс События, разблокирует управление на Карте Мира


## Интерфейс события

Событие оформлено в виде всплывающего поверх Карты Мира окна. Окно блокирует перемещение игрока на карте мира до тех пор, пока остается активным, и не будет закрыто. Окно состоит из следующих частей:

- Заголовок события и уровень События (указан в скобках)
- Художественный текст, собранный по шаблону из словаря 
- Портрет активного Героя
- Две кнопки с описанием награды - подтверждают сделанный выбор, закрывают окно

## Компоненты Событий

- Таблица сочетаний Атрибут/Черта; тексты заголовков Событий
- Вероятности возникновения Событий в завис. от Силы Черты
- Список наград за События (в двух вариантах - Вариант 1, Вариант 2 - на выбор), размеры наград, вероятности для уточнения наград внутри вариантов
- Шаблоны художественного описания События с указанием применения их в зависимости от Силы Черты
- Словарь Событий

Словарь и шаблоны события описаны на этом листе: https://docs.google.com/spreadsheets/d/12acMQ8UTlDRHP0NvzSGVLYKb9QMhw2AjD9EKXTQug3U/edit#gid=1803719375






