#poi #spec

## Введение

Смотровая вышка - POI на Карте Мира, временно открывающая Туман Войны в некотром радиусе вокруг себя. Помогает игроку спланировать маршрут с учетом открывшихся ему POI, вражеских Отрядов, типов Гексов.  


## Компоненты механики

- Механизм расчета радиуса обзора Смотровой Вышки
- Объект Смотровая Вышка на Карте Мира (poi), открывающая Туман Войны.


## Механизм работы

Туман Войны состоит из двух слоев - верхний, который навсегда исчезает в некоторой области вокруг игрока при перемещении, и нижний - зона присутствия отряда, который приоткрывается только в момент присутствия отряда.

При посещении Отрядом Смотровой Вышки, она открывает вокруг себя оба слоя в области своего обзора, до тех пор, пока отряд находится на клетке с Вышкой.

Когда Отряд покидает Гекс со Смотровой Вышкой, верхний слой в области видимости вышки выключен, но нижний в этот момент закрывает POI и противников и игрок может видеть только рельеф. 

Вышку можно посещать неограниченное количество раз.


## Расчет обзора

Стандарный радиус обзора вокруг Вышки - 5 гексов. На радиус обзора Вышки также влияет наличие Черты Разведчик у Героев. Неважно, у какого количества Героев есть Черта, берется самый зоркий из отряда - тот, у кого Черта максимального Уровня Силы. 

Каждый уровень черты Разведчик позволяет увидеть дальше на один гекс. Например, если в отряде есть Герой с Разведчик (1), то при посещении Вышки радиус обзора становится 6 гексов, если у героя Разведчик (3) - Отряд увидит 8 гексов по радиусу. 

Начиная с Разведчик (3), Отряд запоминает расположения POI и врагов, увиденных с Вышки. Однако разведчик отряда не помнит в точности, что он увидел - на втором слое тумана на Гексах с POI и врагами поверх тумана рисуется символом "?"


## Смотровая вышка: спавн, внешний вид

Вышки спавнятся на Карте Мира случайным образом. Количество зависит от конечного размера карты. Для проверки работы механики можно установить количество Вышек с помощью рандома: от 1 до 2 штук на Экспедицию.

Вышка является анимированным спрайтом. Спрайт Отряда помещается поверх спрайта Смотровой вышки. После ухода Отряда с Гекса с Вышкой спрайт работающей Вышки заменяется другим спрайтом - использованного.

Файлы спрайтов лежат в папке POI/Observation Tower:

https://drive.google.com/drive/folders/1ngH6s6WOsdKR2K8TibY72Sjorc7Cdds2